{% extends "home/layout.html" %}
{% load form_tags %}
{% load staticfiles %}

{% block css %}
	<link rel="stylesheet" href='{% static "home/vendor/datatables/media/css/dataTables.jqueryui.min.css" %}'>
{% endblock %}

{% block js %}
	<script type="text/javascript" src='{% static "home/vendor/datatables/media/js/jquery.dataTables.js" %}'></script>
{% endblock %}

{% block content %}	

<div class="page-title">Worksheets</div>

<div class="panel panel-default">
	<ul id="tabs_a" class="nav nav-tabs">
	    <li {% if request.GET.tab == 'all' %}class='active'{% endif %}>
	    	<a href="?tab=all">All</a>
	    </li>
	    <li {% if request.GET.tab == 'pending_p' %}class='active'{% endif %}>
	    	<a href="?tab=pending_p">Pending Printing</a>
	    </li>
	    <li {% if request.GET.tab == 'pending_r' %}class='active'{% endif %}>
	    	<a href="?tab=pending_r">Pending Results</a>
	    </li>
	</ul>
	<div class="tab-content">
		<table class='table table-bordered table-striped table table-condensed' id='tab_id'>
			<thead>
				<tr>
					<th>Worksheet Ref Number</th>
					<th>Machine Type</th>
					<th>Sample Type</th>
					<th>Date Created</th>
					<th>Stage</th>
					<th>Printed?</th>				
					<th />
				</tr>
			</thead>
		</table><br><br>
	</div>
	
</div>
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Delete Worksheet</h4>
      </div>
      <div class="modal-body">
        <p id="delete_details"></p>
        <input type="hidden" value="" id="delete_pk">
        <input id="delete_reason" type="text" name="delete_reason" class="form-control">
      </div>
      <div class="modal-footer">
      	<button class="btn btn-danger" id="delete">Delete</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>
<script type="text/javascript">
$(document).ready(function() {	
	var oTable = $('#tab_id').dataTable({
		"processing": true,
		"serverSide": true,
		"order": [[ 3, "desc" ]],
		"ajax": "/worksheets/list_json/?{% if machine_type %}machine_type={{machine_type}}{% endif %}&tab={{request.GET.tab}}",
	});
});

function deleteWorksheet(pk, ref_num){
	//alert("Are you sure that you want to delete worksheet "+pk);
	$("#myModal").modal('show');
	$("#delete_reason").val("");
	$("#delete_details").html("You are about to delete worksheet <b>"+ref_num+"</b>, Please give reason below:");
	$("#delete_pk").val(pk);
}

$("#delete").click(function(){
	var delete_reason = $("#delete_reason").val();
	if (delete_reason==''){
		alert("Reason for deleting required");
		return false;
	}else{
		var pk = $("#delete_pk").val();
		var params = {csrfmiddlewaretoken:"{{ csrf_token }}", delete_reason:delete_reason};
		$.post("/worksheets/delete/"+pk+"/", params).done(function( data ) {
			$("#myModal").modal('hide');
		    alert(data);		    
		});

	}
})
</script>
{% endblock %}